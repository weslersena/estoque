function doPost(e) {
  try {
    // Obter os dados do formulário
    let data = {};
    
    // Processar os parâmetros recebidos
    const params = e.parameters;
    for (const key in params) {
      // Pega o primeiro valor se houver múltiplos
      data[key] = decodeURIComponent(params[key][0]); 
    }

    // Log dos dados recebidos (para depuração)
    console.log('Dados recebidos:', data);

    // Validar dados obrigatórios
    if (!data.cliente || !data.pedido) {
      throw new Error('Dados incompletos. Cliente e Pedido são obrigatórios.');
    }

    // Acessar a planilha
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    
    // Preparar os dados para a planilha
    const rowData = [
      data.cliente || '',
      data.arte || '',
      data.arte2 || '',
      data.pedido || '',
      data.maquina || '',
      data.carga || '',
      data.artigo || '',
      data.dataInicio || '',
      data.dataFim || '',
      data.embalagem || '',
      data.roteiro || '',
      data.solicitante || '',
      data.regiao || '',
      data.dataEntrega || '',
      data.quantidade || '',
      data.status || 'Processo',
      data.notes || '',
      new Date().toLocaleString('pt-BR') // Data/hora atual
    ];

    // Adicionar nova linha na planilha
    sheet.appendRow(rowData);

    // Retornar resposta de sucesso
    return ContentService.createTextOutput(JSON.stringify({
      status: 'success',
      message: 'Dados salvos com sucesso!',
      data: data
    })).setMimeType(ContentService.MimeType.JSON);
    
  } catch (error) {
    // Log do erro (para depuração)
    console.error('Erro:', error);
    
    // Retornar resposta de erro
    return ContentService.createTextOutput(JSON.stringify({
      status: 'error',
      message: error.message || 'Erro ao processar os dados'
    })).setMimeType(ContentService.MimeType.JSON);
  }
}
